<?php
$base['dn'] = 'dc=my-ldap,dc=server';
$base['host'] = '192.168.0.95';
$base['port'] = 389;
$base['people'] = 'ou=People,'.$base['dn'];
$base['group'] = 'ou=Group,'.$base['dn'];
$base['admgr'] = 'cn=admin,'.$base['group'];
$base['stfgr'] = 'cn=staff,'.$base['group'];

function isldapAuth ($name,$pass) {

        global $base;

        $link_id = ldap_connect($base['host'],$base['port']);

	if ($link_id) {
		
		$ldapdn = 'uid='.$name.','.$base['people'];
		$attrs = array('memberof');
        	ldap_set_option($link_id, LDAP_OPT_PROTOCOL_VERSION, 3);
        	ldap_set_option($link_id, LDAP_OPT_REFERRALS, 0);
	
		$bind =  ldap_bind($link_id,$ldapdn,$pass);
		
		if ($bind) {
			return $link_id;
		}

	}
	else {
		return false;
	}		
}


function chkGroup ($link_id, $name) {

	global $base;
	$filt = '(& (uid='.$name.') (| (memberof='.$base['admgr'].')(memberof='.$base["stfgr"].')))';
		
	$res = ldap_search($link_id, $base['people'], $filt);
	$info = ldap_get_entries($link_id,$res);
	print_r($info);
	if ($info['count']) {
		return $link_id;
	}

	else {
		return false;
	}
}

?>
